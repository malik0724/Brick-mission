<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Brick Mission – Power Mode</title>

<style>
body{margin:0;background:#000;overflow:hidden;font-family:Arial;color:#0ff;touch-action:none}
canvas{display:block}
#ui{
position:absolute;top:0;width:100%;height:60px;
background:rgba(0,0,0,.85);display:flex;
justify-content:space-between;align-items:center;
padding:0 12px;border-bottom:2px solid #0ff;z-index:10}
.btn{
background:#111;color:#0ff;border:1px solid #0ff;
padding:6px 14px;border-radius:20px;
transition:.2s;box-shadow:0 0 10px #0ff;
animation:pulse 1.5s infinite alternate}
.btn:active{transform:scale(.9)}
@keyframes pulse{to{box-shadow:0 0 20px #0ff}}
#combo{position:absolute;top:70px;left:50%;transform:translateX(-50%);
font-size:22px;color:#0f0;text-shadow:0 0 10px #0f0}
.popup{
position:absolute;inset:0;background:rgba(0,0,0,.95);
display:flex;justify-content:center;align-items:center;
flex-direction:column;z-index:50}
.hidden{display:none}
</style>
</head>

<body>

<div id="ui">
  <div>MISSION <span id="lvl">1</span></div>
  <div>BALLS <span id="bc">20</span></div>
  <button class="btn" onclick="togglePause()">⏯</button>
</div>

<div id="combo">x1</div>

<div id="start" class="popup">
  <h1>BRICK MISSION</h1>
  <button class="btn" onclick="startGame()">START</button>
</div>

<canvas id="c"></canvas>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
const lvlEl=document.getElementById("lvl"),bc=document.getElementById("bc");
const comboEl=document.getElementById("combo"),startUI=document.getElementById("start");

let W,H,floorY,paused=false,started=false,firing=false;
let balls=[],bricks=[],aiming=false,powerups=[];
let aimDX=0,aimDY=-1;
let level=1,totalBalls=20,combo=1;
let fireMode=false,slowMode=false;

function resize(){W=c.width=innerWidth;H=c.height=innerHeight;floorY=H-100;}
resize();onresize=resize;

function startGame(){started=true;startUI.classList.add("hidden");spawn();}
function togglePause(){paused=!paused;}

function spawn(){
balls=[];bricks=[];combo=1;comboEl.textContent="x1";
fireMode=false;slowMode=false;powerups=[];
let cols=8,p=4,size=(W-(p*9))/8;
for(let r=0;r<5;r++){
 for(let x=0;x<cols;x++){
  if(Math.random()>.4){
   bricks.push({x:p+x*(size+p),y:80+r*(size+p),w:size,h:size,hp:level*2+r});
}}}
bc.textContent=totalBalls;lvlEl.textContent=level;
}

function updateAim(tx,ty){
let dx=tx-W/2,dy=ty-floorY;
if(dy>-50)dy=-50;
let len=Math.hypot(dx,dy);
aimDX=dx/len;aimDY=dy/len;
}

addEventListener("touchstart",e=>{
if(!started||paused||firing)return;
aiming=true;updateAim(e.touches[0].clientX,e.touches[0].clientY);
});
addEventListener("touchmove",e=>{
if(aiming)updateAim(e.touches[0].clientX,e.touches[0].clientY);
});
addEventListener("touchend",()=>{
if(!aiming||firing)return;
aiming=false;fire();
});

function fire(){
firing=true;
for(let i=0;i<totalBalls;i++){
setTimeout(()=>balls.push({
x:W/2,y:floorY,
vx:aimDX*(slowMode?6:12),
vy:aimDY*(slowMode?6:12),
live:true
}),i*60);
}
}

function update(){
if(paused||!started)return;
balls.forEach(b=>{
if(!b.live)return;
b.x+=b.vx;b.y+=b.vy;
if(b.x<5||b.x>W-5)b.vx*=-1;
if(b.y<60)b.vy*=-1;
if(b.y>floorY)b.live=false;

bricks.forEach(br=>{
if(b.x>br.x&&b.x<br.x+br.w&&b.y>br.y&&b.y<br.y+br.h){
if(!fireMode)b.vy*=-1;
br.hp-=fireMode?2:1;
combo++;comboEl.textContent="x"+combo;

if(Math.random()<0.25){
let t=["multi","fire","slow"][Math.floor(Math.random()*3)];
powerups.push({x:br.x+br.w/2,y:br.y+br.h/2,type:t,active:true});
}
}
});
bricks=bricks.filter(b=>b.hp>0);
});

powerups.forEach(p=>{
p.y+=3;
if(Math.hypot(p.x-W/2,p.y-floorY)<20){
if(p.type==="multi")totalBalls+=5;
if(p.type==="fire")fireMode=true;
if(p.type==="slow")slowMode=true;
p.active=false;
}
if(p.y>floorY)p.active=false;
});
powerups=powerups.filter(p=>p.active);

if(firing&&balls.every(b=>!b.live)){balls=[];firing=false;}
}

function draw(){
ctx.clearRect(0,0,W,H);

if(aiming&&!firing){
ctx.setLineDash([6,12]);ctx.strokeStyle="#0ff";
ctx.beginPath();ctx.moveTo(W/2,floorY);
ctx.lineTo(W/2+aimDX*600,floorY+aimDY*600);
ctx.stroke();ctx.setLineDash([]);
}

bricks.forEach(b=>{
ctx.fillStyle=`hsl(${200+b.hp*10},80%,50%)`;
ctx.fillRect(b.x,b.y,b.w,b.h);
});

ctx.fillStyle="#fff";
balls.forEach(b=>{if(b.live){ctx.beginPath();
ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();}});

powerups.forEach(p=>{
ctx.shadowBlur=15;
ctx.fillStyle=p.type==="multi"?"#0ff":p.type==="fire"?"#f00":"#ff0";
ctx.beginPath();ctx.arc(p.x,p.y,8,0,Math.PI*2);ctx.fill();
ctx.shadowBlur=0;
});

update();requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
